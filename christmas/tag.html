<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üéÑ</title>
  <style>
    :root{
      /* Peaceful Night Sky (Scandi Christmas) */
      --bg1:#050916;           /* deep navy */
      --bg2:#07122a;           /* midnight */
      --bg3:#0b1a33;           /* soft horizon navy */
      --card:#1a2f1a;          /* dark pine */
      --card2:#2d4a2d;         /* lighter pine */
      --text:#f4f2ed;
      --muted:#e7e2d6cc;
      --gold:#d8c38a;
      --red:#8f2f2b;
      --green:#1f3d32;
      --shadow: 0 20px 60px #00000066;

      /* scratch overlay */
      --scratch:#cfd2d6;       /* base silver */
      --scratchInk:rgba(20,24,28,.55);
      --meta:#b9a99bd9;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
      overflow:hidden;
      background:
        radial-gradient(1000px 700px at 20% 15%, #1a2b5a55 0%, transparent 60%),
        radial-gradient(900px 650px at 85% 25%, #2a1c2450 0%, transparent 58%),
        radial-gradient(1200px 800px at 50% 110%, #0b1a3355 0%, transparent 62%),
        linear-gradient(160deg, var(--bg1), var(--bg2) 55%, var(--bg3));
    }

    .aurora{
      position:fixed; inset:-20%;
      background:
        radial-gradient(closest-side at 25% 30%, #ffffff10, transparent 66%),
        radial-gradient(closest-side at 60% 35%, #d8c38a10, transparent 72%),
        radial-gradient(closest-side at 70% 60%, #3b4a8a14, transparent 74%),
        radial-gradient(closest-side at 40% 75%, #8f2f2b10, transparent 76%);
      filter: blur(34px);
      animation: drift 16s ease-in-out infinite alternate;
      pointer-events:none;
      z-index: 1;
    }
    @keyframes drift{
      from{transform:translate3d(-2%, -1%, 0) scale(1.02) rotate(-2deg)}
      to{transform:translate3d(2%, 1%, 0) scale(1.05) rotate(2deg)}
    }

    #starfield {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 2;
    }

    @media (prefers-reduced-motion: reduce) {
      .aurora, .badge { animation: none; }
      #starfield {
        background-image:
          radial-gradient(1px 1px at 20px 30px, #fff, transparent),
          radial-gradient(1px 1px at 40px 70px, #ddd, transparent),
          radial-gradient(2px 2px at 50px 50px, #eee, transparent),
          radial-gradient(1px 1px at 80px 10px, #fff, transparent),
          radial-gradient(1px 1px at 130px 80px, #ddd, transparent),
          radial-gradient(2px 2px at 110px 120px, #fff, transparent);
        background-size: 200px 200px;
        background-repeat: repeat;
      }
    }

    .star-east{
      position:fixed;
      left: 50%;
      top: clamp(18px, 4vh, 56px);
      width: 18px;
      height: 18px;
      pointer-events:none;
      z-index:3;
      filter: drop-shadow(0 0 18px rgba(216,195,138,.55))
              drop-shadow(0 0 42px rgba(216,195,138,.25));
      animation: twinkle 3.8s ease-in-out infinite;
    }
    .star-east:before, .star-east:after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(circle at 50% 50%, #fff 0 22%, #d8c38a 40%, transparent 72%);
      border-radius:50%;
    }
    .star-east:after{
      position:absolute;
      left:50%; top:50%;
      width: 80px; height: 2px;
      transform: translate(-50%,-50%);
      background: linear-gradient(90deg, transparent, rgba(216,195,138,.45), transparent);
      filter: blur(.2px);
    }
    .star-east i{
      position:absolute;
      left:50%; top:50%;
      width:2px; height:80px;
      transform: translate(-50%,-50%);
      background: linear-gradient(180deg, transparent, rgba(216,195,138,.35), transparent);
      display:block;
    }
    @keyframes twinkle{
      0%,100%{transform:translateX(-50%) scale(1); opacity:.85}
      50%{transform:translateX(-50%) scale(1.08); opacity:1}
    }

    .wrap{
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:24px;
      position:relative;
      z-index:4;
    }

    .card{
      width:min(820px, 92vw);
      border-radius:28px;
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid #ffffff1a;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.05),
        var(--shadow),
        0 0 120px rgba(216, 195, 138, 0.4),
        inset 0 1px 0 rgba(255,255,255,0.1);
      padding: clamp(22px, 4vw, 42px);
      backdrop-filter: blur(14px);
      position:relative;
      overflow:hidden;
    }

    .card:before{
      content:"";
      position:absolute; inset:0;
      border-radius:28px;
      padding:1.5px;
      background: linear-gradient(90deg, #d8c38a55, #ffffff22, #3b4a8a55, #8f2f2b55);
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
              mask-composite: exclude;
      pointer-events:none;
    }

    .toprow{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:14px;
      margin-bottom:16px;
      flex-wrap:wrap;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:14px 18px;
      border-radius:999px;
      background:#00000022;
      border:1px solid #ffffff1a;
      font-weight:900;
      letter-spacing:.06em;
      color: var(--gold);
      font-size: clamp(18px, 3.2vw, 30px);
      box-shadow: 0 0 15px rgba(216, 195, 138, 0.4);
      animation: pulse-glow 8s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(216, 195, 138, 0.4); }
      50% { transform: scale(1.03); box-shadow: 0 0 25px rgba(216, 195, 138, 0.6); }
    }

    .sub{
      margin:0 0 14px;
      text-align:center;
      color:var(--muted);
      font-size: clamp(16px, 2.7vw, 20px);
      line-height:1.45;
      text-transform: lowercase;
    }

    .nameWrap{
      position:relative;
      margin: 10px auto 12px;
      width: min(720px, 100%);
      height: clamp(120px, 22vh, 180px);
      border-radius:22px;
      border:1px solid #ffffff1a;
      background:#00000018;
      overflow:hidden;
      display:grid;
      place-items:center;
    }

    .name{
      font-weight:950;
      letter-spacing:.06em;
      line-height:1;
      font-size: clamp(58px, 10vw, 120px);
      text-align:center;
      text-shadow: 0 0 22px #ffffff10, 0 0 40px #d8c38a10;
    }

    canvas#scratch{
      position:absolute; inset:0;
      width:100%; height:100%;
      touch-action:none;
      cursor: pointer;
    }

    .from{
      text-align:center;
      margin-top:10px;
      margin-bottom:28px;
      color:var(--muted);
      font-weight:700;
      letter-spacing:.02em;
      font-size: clamp(15px, 2.6vw, 20px);
    }

    .from strong{
      color:var(--text);
      font-size:1.15em;
      font-weight:800;
    }

    .faith{
      text-align:center;
      text-transform:uppercase;
      letter-spacing:.06em;
      font-size: clamp(12px, 2.2vw, 16px);
      color: var(--muted);
      margin-top: 40px;
    }

    .verse + .verse{ margin-top:18px; }

    .quote{
      color: var(--gold);
      font-weight:800;
    }

    .ref{
      margin-top:6px;
      color: var(--muted);
      font-weight:800;
      letter-spacing:.10em;
    }

    .meta{
      margin-top:6px;
      color: var(--meta);
      font-weight:700;
      letter-spacing:.04em;
      text-transform:none;
      font-size:0.92em;
    }
  </style>
</head>

<body>
  <div class="aurora"></div>
  <canvas id="starfield"></canvas>
  <div class="star-east" aria-hidden="true"><i></i></div>

  <div class="wrap">
    <div class="card">

      <div class="toprow">
        <div class="badge">MERRY CHRISTMAS ‚ú∂‚òß</div>
      </div>

      <p class="sub">this present is for...</p>

      <div class="nameWrap" id="wrapScratch">
        <div class="name" id="recipientName">YOU</div>
        <canvas id="scratch"></canvas>
      </div>

      <div class="from">from <span id="fromLine"><strong>Hannah</strong> &amp; <strong>Dantan</strong></span>&nbsp;&nbsp;</div>

      <div class="faith">
        <div class="verse">
          <div class="quote">‚ÄúFor unto us a child is born.‚Äù</div>
          <div class="ref">‚Äî ISAIAH 9:6</div>
          <div class="meta">(prophecy written 700+ years before Jesus was born)</div>
        </div>

        <div class="verse">
          <div class="quote">‚ÄúFor unto you is born‚Ä¶ a Savior.‚Äù</div>
          <div class="ref">‚Äî LUKE 2:11</div>
          <div class="meta">(written after Jesus was born)</div>
        </div>
      </div>

    </div>
  </div>

<script>
(() => {
  // ---- TO + FROM FROM URL ----
  // Use: /christmas/tag.html?to=Judah

  function sanitizeName(input){
    if (!input) return "YOU";
    const s = input.toString().trim();
    const cleaned = s.replace(/[^a-z0-9 .,'-]/gi, "").slice(0, 24);
    return cleaned ? cleaned.toUpperCase() : "YOU";
  }

  const FROM_BY_TO = {
    "Judah":   "<strong>Auntie Hannie</strong> &amp; <strong>Uncle Dantan</strong>",
    "Benjamin":"<strong>Auntie Hannie</strong> &amp; <strong>Uncle Dantan</strong>",
    "Shepherd":"<strong>Auntie Hannie</strong> &amp; <strong>Uncle Dantan</strong>",
    "Calvin":  "<strong>Auntie Hannie</strong> &amp; <strong>Uncle Dantan</strong>",

    "Grammie": "<strong>Hannah</strong> &amp; <strong>Dantan</strong>",
    "Poppo":   "<strong>Hannah</strong> &amp; <strong>Dantan</strong>",
    "Gideon":  "<strong>Hannah</strong> &amp; <strong>Dantan</strong>",
    "Janet":   "<strong>Hannah</strong> &amp; <strong>Dantan</strong>",
    "Papaw":   "<strong>Hannah</strong> &amp; <strong>Dantan</strong>",

    "Meredith":"<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Ben":     "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Candace": "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Pete":    "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Stephen": "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Jessy":   "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Mom": "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",
    "Dad":   "<strong>Dantan</strong> &amp; <strong>Hannah</strong>",

    "Athena":  "<strong>Uncle Dantan</strong> &amp; <strong>Auntie Hannah</strong>",
    "Elise":   "<strong>Uncle Dantan</strong> &amp; <strong>Auntie Hannah</strong>",
    "Evelyn":  "<strong>Uncle Dantan</strong> &amp; <strong>Auntie Hannah</strong>",
    "Jax":     "<strong>Uncle Dantan</strong> &amp; <strong>Auntie Hannah</strong>"
  };

  const params = new URLSearchParams(location.search);
  const rawTo = (params.get("to") || "").trim();

  const toEl = document.getElementById("recipientName");
  if (toEl) toEl.textContent = sanitizeName(rawTo);

  const fromEl = document.getElementById("fromLine");
  if (fromEl) {
    fromEl.innerHTML = FROM_BY_TO[rawTo] || "<strong>Hannah</strong> &amp; <strong>Dantan</strong>";
  }

  // STARFIELD TIMELAPSE (LESS STREAKY)
  const starCanvas = document.getElementById('starfield');
  const starCtx = starCanvas.getContext('2d');
  let stars = [];
  let animationId;

  function initStarfield() {
    if (animationId) cancelAnimationFrame(animationId);

    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) {
      starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
      return;
    }

    starCanvas.width = window.innerWidth;
    starCanvas.height = window.innerHeight;

    stars = [];
    const numStars = 250;
    for (let i = 0; i < numStars; i++) {
      stars.push({
        x: Math.random() * starCanvas.width,
        y: Math.random() * starCanvas.height,
        size: Math.random() * 1.5,
        speed: Math.random() * 0.25 + 0.05,
        opacity: Math.random() * 0.8 + 0.2
      });
    }

    starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
    animateStars();
  }

  function animateStars() {
    starCtx.fillStyle = 'rgba(5, 9, 22, 0.28)';
    starCtx.fillRect(0, 0, starCanvas.width, starCanvas.height);

    starCtx.fillStyle = '#ffffff';
    const t = performance.now() * 0.001;

    for (const star of stars) {
      const tw = 0.85 + Math.sin(t + star.x * 0.01) * 0.15;
      starCtx.globalAlpha = star.opacity * tw;

      starCtx.beginPath();
      starCtx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
      starCtx.fill();

      star.x -= star.speed;
      if (star.x < 0) star.x = starCanvas.width;
    }

    starCtx.globalAlpha = 1;
    animationId = requestAnimationFrame(animateStars);
  }

  window.addEventListener('resize', initStarfield, { passive: true });
  initStarfield();

  // SCRATCH-OFF (KID-FRIENDLY: FEW SWIPES)
  const wrap = document.getElementById('wrapScratch');
  const canvas = document.getElementById('scratch');
  const ctx = canvas.getContext('2d', { willReadFrequently: true });

  let drawing = false;
  let lastX = 0, lastY = 0;
  let dpr = Math.max(1, window.devicePixelRatio || 1);

  const COMPLETE_THRESHOLD = 0.22;
  const CHECK_EVERY_MS = 180;
  let lastCheck = 0;

  function resizeScratch(){
    const r = wrap.getBoundingClientRect();
    dpr = Math.max(1, window.devicePixelRatio || 1);

    canvas.width  = Math.max(1, Math.floor(r.width  * dpr));
    canvas.height = Math.max(1, Math.floor(r.height * dpr));

    canvas.style.width  = r.width  + "px";
    canvas.style.height = r.height + "px";

    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.scale(dpr, dpr);

    paintScratch(r.width, r.height);
  }

  function paintScratch(w, h){
    ctx.globalCompositeOperation = "source-over";

    const g = ctx.createLinearGradient(0, 0, w, h);
    g.addColorStop(0.00, "#e7eaee");
    g.addColorStop(0.18, "#cfd3d9");
    g.addColorStop(0.38, "#f3f5f7");
    g.addColorStop(0.62, "#c6cbd2");
    g.addColorStop(0.82, "#eef1f4");
    g.addColorStop(1.00, "#cdd1d7");
    ctx.fillStyle = g;
    ctx.fillRect(0, 0, w, h);

    ctx.globalAlpha = 0.35;
    for (let i = -h; i < w + h; i += 6) {
      const shade = 200 + Math.floor(Math.random() * 35);
      ctx.strokeStyle = `rgba(${shade},${shade},${shade},0.35)`;
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(i, 0);
      ctx.lineTo(i + h, h);
      ctx.stroke();
    }
    ctx.globalAlpha = 1;

    ctx.fillStyle = "rgba(0,0,0,.07)";
    for(let i=0;i<850;i++){
      const x=Math.random()*w, y=Math.random()*h, rr=Math.random()*1.2;
      ctx.beginPath(); ctx.arc(x,y,rr,0,Math.PI*2); ctx.fill();
    }

    ctx.globalAlpha = 0.18;
    for (let b=0; b<3; b++){
      const yy = (h * (0.25 + b*0.22)) + (Math.random()*10-5);
      const band = ctx.createLinearGradient(0, yy-20, 0, yy+20);
      band.addColorStop(0, "rgba(255,255,255,0)");
      band.addColorStop(0.5, "rgba(255,255,255,0.55)");
      band.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = band;
      ctx.fillRect(0, yy-22, w, 44);
    }
    ctx.globalAlpha = 1;

    ctx.textAlign = "center";
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--scratchInk').trim();
    ctx.font = "900 20px system-ui, -apple-system, BlinkMacSystemFont";
    ctx.fillText("SCRATCH", w/2, h/2 + 6);

    ctx.globalCompositeOperation = "destination-out";
    ctx.globalAlpha = 1;
  }

  function getPoint(e){
    const r = canvas.getBoundingClientRect();
    return { x: e.clientX - r.left, y: e.clientY - r.top };
  }

  function brushSize(){
    const r = wrap.getBoundingClientRect();
    const base = Math.min(r.width, r.height);
    return Math.max(58, Math.min(96, base * 0.34));
  }

  function stamp(x, y, rr){
    ctx.beginPath();
    ctx.arc(x, y, rr, 0, Math.PI * 2);
    ctx.fill();
  }

  function scratchLineTo(x, y){
    const lw = brushSize();
    const rr = lw / 2;

    ctx.globalAlpha = 1;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.lineWidth = lw;

    const dx = x - lastX;
    const dy = y - lastY;
    const dist = Math.hypot(dx, dy);

    const step = Math.max(1, rr / 4);
    const steps = Math.max(1, Math.ceil(dist / step));

    for (let i = 1; i <= steps; i++){
      const tt = i / steps;
      stamp(lastX + dx * tt, lastY + dy * tt, rr);
    }

    lastX = x; lastY = y;
  }

  function percentCleared(){
    const img = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const data = img.data;
    let transparent = 0;

    const step = 16;
    for (let i = 3; i < data.length; i += step) {
      if (data[i] === 0) transparent++;
    }
    const total = data.length / step;
    return transparent / total;
  }

  function maybeComplete(now){
    if (now - lastCheck < CHECK_EVERY_MS) return;
    lastCheck = now;

    try {
      if (percentCleared() >= COMPLETE_THRESHOLD) {
        drawing = false;
        canvas.style.transition = "opacity 240ms ease";
        canvas.style.opacity = "0";
        setTimeout(() => { canvas.remove(); }, 260);
      }
    } catch (_) {}
  }

  function onDown(e){
    drawing = true;
    canvas.setPointerCapture(e.pointerId);
    const p = getPoint(e);
    lastX = p.x; lastY = p.y;
    stamp(p.x, p.y, brushSize()/2);
  }

  function onMove(e){
    if(!drawing) return;
    e.preventDefault();
    const p = getPoint(e);
    scratchLineTo(p.x, p.y);
    maybeComplete(performance.now());
  }

  function onUp(e){
    drawing = false;
    try { canvas.releasePointerCapture(e.pointerId); } catch (_) {}
    maybeComplete(performance.now());
  }

  canvas.addEventListener('pointerdown', onDown, { passive: true });
  canvas.addEventListener('pointermove', onMove, { passive: false });
  canvas.addEventListener('pointerup', onUp, { passive: true });
  canvas.addEventListener('pointercancel', onUp, { passive: true });
  canvas.addEventListener('pointerleave', () => { drawing = false; }, { passive: true });

  window.addEventListener('resize', resizeScratch, { passive: true });
  resizeScratch();
})();
</script>
</body>
</html>
